<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predicci√≥n de Potencia</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 0;
            text-align: center;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            padding: 10px;
        }

        .logo {
            height: 60px;
            max-width: 100%;
        }

        h1 {
            margin: 0;
            font-size: 2em;
        }

        .titulo-blanco {
            color: white;
            background-color: red;
            padding: 3px 6px;
            border-radius: 5px;
        }

        .container {
            max-width: 900px;
            margin: auto;
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
        }

        canvas {
            max-width: 100%;
            height: auto;
        }

        button {
            background-color: red;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 15px;
        }

        button:hover {
            background-color: darkred;
        }

        #pantallaInicio {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
    </style>
</head>
<body>

<!-- Pantalla de inicio -->
<div id="pantallaInicio">
    <h1><span class="titulo-blanco">Bienvenido</span></h1>
    <button onclick="iniciarApp()">‚ñ∂ Iniciar</button>
</div>

<!-- Encabezado -->
<header>
    <img src="./logo.png" alt="Logo Izquierdo" class="logo">
    <h1><span class="titulo-blanco">Predicci√≥n de Potencia</span></h1>
    <img src="./gato.jpg" alt="Logo Derecho" class="logo">
</header>

<!-- Contenido -->
<div class="container">
    <h2>Potencia en Tiempo Real</h2>
    <canvas id="grafica"></canvas>
    <p id="estado">Esperando datos...</p>
    <button onclick="descargarExcel()">üì• Descargar Historial Excel</button>
</div>

<!-- Librer√≠a de gr√°ficas -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const channelID = "TU_CHANNEL_ID";  
    const readAPIKey = "TU_READ_API_KEY"; 
    const fieldNumber = 1; 

    const ctx = document.getElementById('grafica').getContext('2d');
    const grafica = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Potencia (kW)',
                borderColor: 'red',
                backgroundColor: 'transparent',
                borderWidth: 2,
                data: []
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: { title: { display: true, text: 'Tiempo' } },
                y: { title: { display: true, text: 'Potencia (kW)' } }
            }
        }
    });

    async function obtenerDatosThingSpeak() {
        try {
            const url = `https://api.thingspeak.com/channels/${channelID}/fields/${fieldNumber}.json?results=20&api_key=${readAPIKey}`;
            const respuesta = await fetch(url);
            const datos = await respuesta.json();

            const labels = datos.feeds.map(feed => new Date(feed.created_at).toLocaleTimeString());
            const valores = datos.feeds.map(feed => parseFloat(feed[`field${fieldNumber}`]));

            grafica.data.labels = labels;
            grafica.data.datasets[0].data = valores;
            grafica.update();

            document.getElementById("estado").textContent = "Datos actualizados ‚úÖ";
        } catch (error) {
            document.getElementById("estado").textContent = "Error al obtener datos ‚ùå";
            console.error(error);
        }
    }

    function descargarExcel() {
        const url = `https://api.thingspeak.com/channels/${channelID}/fields/${fieldNumber}.csv?api_key=${readAPIKey}`;
        window.open(url, "_blank");
    }

    function iniciarApp() {
        document.getElementById("pantallaInicio").style.display = "none";
        obtenerDatosThingSpeak();
        setInterval(obtenerDatosThingSpeak, 15000);
    }
</script>

</body>
</html>
